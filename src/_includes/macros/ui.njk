{# 
  UI Macros Library
  Centralizes logic for reusable components.
#}

{# --- Button Macro --- #}
{% macro button(text='Clique aqui', href='#', variant='module', icon='', title='', class='', attrs='') %}
  {% set isFontAwesome = icon and ('fa-' in icon) %}
  {% set btnClass = 'btn--nav' if variant == 'nav' else 'btn--module' %}
  {% set strText = '' ~ text %}
  {% set iconAfter = strText.indexOf('Próximo') == 0 %}
  
  <a href="{{ href | url }}" class="btn {{ btnClass }} {{ class }}" {% if title %}title="{{ title }}"{% endif %} {{ attrs | safe }}>
    {% if icon and not iconAfter %}
      {% if isFontAwesome %}
        <i class="btn__icon {{ icon }}" aria-hidden="true"></i>
      {% else %}
        <span class="btn__icon">{{ icon }}</span>
      {% endif %}
    {% endif %}
    <span class="btn__text">{{ text }}</span>
    {% if icon and iconAfter %}
      {% if isFontAwesome %}
        <i class="btn__icon {{ icon }}" aria-hidden="true"></i>
      {% else %}
        <span class="btn__icon">{{ icon }}</span>
      {% endif %}
    {% endif %}
  </a>
{% endmacro %}

{# --- Alert Macro --- #}
{% macro alert(type='note', title='', text='', icon='', ariaLabel='') %}
  {% set alertConfig = {
    'note': {
      'icon': 'fa-note-sticky',
      'defaultTitle': 'Observação',
      'ariaLabel': 'Observação'
    },
    'tip': {
      'icon': 'fa-lightbulb',
      'defaultTitle': 'Dica',
      'ariaLabel': 'Dica'
    },
    'information': {
      'icon': 'fa-circle-info',
      'defaultTitle': 'Informação',
      'ariaLabel': 'Informação'
    },
    'caution': {
      'icon': 'fa-circle-xmark',
      'defaultTitle': 'Cuidado',
      'ariaLabel': 'Cuidado'
    },
    'warning': {
      'icon': 'fa-triangle-exclamation',
      'defaultTitle': 'Aviso',
      'ariaLabel': 'Aviso'
    }
  } %}

  {% set config = alertConfig[type] or alertConfig['note'] %}
  {% set finalIcon = icon or config.icon %}
  {% set finalTitle = title or config.defaultTitle %}
  {% set finalAriaLabel = ariaLabel or config.ariaLabel %}

  <div class="alert alert--{{ type }}" role="note" aria-label="{{ finalAriaLabel }}">
    <div class="alert__head">
      <i class="alert__icon fa-solid {{ finalIcon }}" aria-hidden="true"></i>
      <h3 class="alert__title">{{ finalTitle }}</h3>
    </div>
    <p class="alert__text">{{ text | safe }}</p>
  </div>
{% endmacro %}

{# --- Code Block Macro --- #}
{% macro codeBlock(code='', language='bash') %}
<div class="code-block-wrapper">
  <pre class="terminal__block terminal__block--{{ language }}"><code>{{ code }}</code></pre>
  <button class="code-block__copy-btn" aria-label="Copiar código" title="Copiar código">
    <i class="fa-regular fa-copy" aria-hidden="true"></i>
    <span>Copiar</span>
  </button>
</div>
{% endmacro %}

{# --- Breadcrumb Macro --- #}
{% macro breadcrumb(items=[]) %}
<nav aria-label="Breadcrumb" class="breadcrumb">
  <ol class="breadcrumb__list">
    {% for item in items %}
      <li class="breadcrumb__item">
        {% if loop.last %}
          <span class="breadcrumb__current" aria-current="page">
            {% if item.icon %}<i class="{{ item.icon }}" aria-hidden="true"></i>{% endif %} {{ item.label }}
          </span>
        {% else %}
          <a href="{{ item.href | url }}" class="breadcrumb__link">
            {% if item.icon %}<i class="{{ item.icon }}" aria-hidden="true"></i>{% endif %} {{ item.label }}
          </a>
          <span class="breadcrumb__separator" aria-hidden="true">/</span>
        {% endif %}
      </li>
    {% endfor %}
  </ol>
</nav>
{% endmacro %}

{# --- Checklist Macro --- #}
{% macro checklist(items=[]) %}
  {% if items and items.length > 0 %}
  <section class="module-checklist" aria-label="Checklist do módulo">
    <h2 class="module-checklist__title">
      <i class="fa-solid fa-list-check"></i> Checklist
    </h2>
    
    <div class="module-checklist__items">
      {% for item in items %}
      <label class="module-checklist__item">
        <input 
          type="checkbox" 
          id="checklist-{{ item.id }}"
          class="module-checklist__input"
          {% if item.completed %}checked{% endif %}
        />
        <span class="module-checklist__label">{{ item.label }}</span>
      </label>
      {% endfor %}
    </div>
    
    <div class="module-checklist__summary">
      <p class="module-checklist__summary-text">
        <span id="checklist-count">0</span> de {{ items.length }} itens
      </p>
    </div>
  </section>
  {% endif %}
{% endmacro %}

{# --- Module Card Macro --- #}
{% macro moduleCard(id='', level='', title='', description='', href='#', buttonText='Acessar Módulo') %}
<article class="module__card" data-module-id="{{ id }}">
  <div class="module__header">
    <p class="module__level">{{ level }}</p>
    <h3 class="module__title">{{ title }}</h3>
  </div>
  <p class="module__description">
    {{ description }}
  </p>
  {{ button(href=href, text=buttonText, title=buttonText ~ ' ' ~ title) }}
  <button class="module__complete-btn" onclick="toggleModuleComplete('{{ id }}');">
    <i class="btn-icon fa-regular fa-square"></i> <span class="btn-text">Marcar como Concluído</span>
  </button>
</article>
{% endmacro %}

{# --- Tabs Macro --- #}
{% macro tabs(id, items=[]) %}
<div class="tabs" id="{{ id }}">
  <div class="tabs__list" role="tablist" aria-label="{{ id }}">
    {% for item in items %}
      <button 
        type="button"
        class="tabs__trigger" 
        role="tab" 
        aria-selected="{{ 'true' if loop.first else 'false' }}" 
        aria-controls="{{ id }}-panel-{{ loop.index }}" 
        id="{{ id }}-tab-{{ loop.index }}"
        tabindex="{{ '0' if loop.first else '-1' }}"
      >
        {% if item.icon %}<i class="{{ item.icon }}" aria-hidden="true"></i>{% endif %}
        {{ item.label }}
      </button>
    {% endfor %}
  </div>
  
  {% for item in items %}
    <div class="tabs__panel" role="tabpanel" id="{{ id }}-panel-{{ loop.index }}" aria-labelledby="{{ id }}-tab-{{ loop.index }}" {{ '' if loop.first else 'hidden' }}>
      <div class="tabs__content">
        {{ item.content | safe }}
      </div>
    </div>
  {% endfor %}
</div>
{% endmacro %}

{# --- Accordion Macro --- #}
{% macro accordion(id, items=[]) %}
<div class="accordion" id="{{ id }}">
  {% for item in items %}
    <div class="accordion__item">
      <button 
        type="button"
        class="accordion__trigger" 
        aria-expanded="false" 
        aria-controls="{{ id }}-panel-{{ loop.index }}" 
        id="{{ id }}-header-{{ loop.index }}"
      >
        <span class="accordion__title">{{ item.title }}</span>
        <i class="accordion__icon fa-solid fa-chevron-down" aria-hidden="true"></i>
      </button>
      <div 
        id="{{ id }}-panel-{{ loop.index }}" 
        role="region" 
        aria-labelledby="{{ id }}-header-{{ loop.index }}" 
        class="accordion__panel" 
        hidden
      >
        <div class="accordion__content">
          {{ item.content | safe }}
        </div>
      </div>
    </div>
  {% endfor %}
</div>
{% endmacro %}

{# --- Modal Macro --- #}
{% macro modal(id, title='', content='') %}
<div id="{{ id }}" class="modal" aria-hidden="true">
  <div class="modal__overlay" tabindex="-1" data-modal-close></div>
  <div class="modal__container" role="dialog" aria-modal="true" aria-labelledby="{{ id }}-title">
    <header class="modal__header">
      <h2 id="{{ id }}-title" class="modal__title">{{ title }}</h2>
      <button type="button" class="modal__close" aria-label="Fechar" data-modal-close>
        <i class="fa-solid fa-xmark" aria-hidden="true"></i>
      </button>
    </header>
    <div class="modal__content">
      {{ content | safe }}
    </div>
  </div>
</div>
{% endmacro %}

{# --- Badge Macro --- #}
{% macro badge(text='Novo', variant='default', icon='') %}
  <span class="badge badge--{{ variant }}">
    {% if icon %}<i class="{{ icon }}" aria-hidden="true"></i>{% endif %}
    {{ text }}
  </span>
{% endmacro %}

{# --- Video Macro --- #}
{% macro video(videoId, title='Vídeo do YouTube', caption='') %}
<figure class="video-component">
  <div class="video-container">
    <iframe 
      src="https://www.youtube.com/embed/{{ videoId }}" 
      title="{{ title }}" 
      frameborder="0" 
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
      allowfullscreen>
    </iframe>
  </div>
  {% if caption %}
  <figcaption class="video-caption">{{ caption | safe }}</figcaption>
  {% endif %}
</figure>
{% endmacro %}

{# --- Tooltip (Glossary) Macro --- #}
{% macro tooltip(term, definition) %}
<span class="tooltip" tabindex="0">
  {{ term }}
  <span class="tooltip__box" role="tooltip">
    {{ definition | safe }}
  </span>
</span>
{% endmacro %}

{# --- Quiz Macro --- #}
{% macro quiz(id, question, options=[], correctMessage='Correto! Mandou bem.', incorrectMessage='Ops! Tente novamente.') %}
<div class="quiz" id="{{ id }}" data-quiz data-correct-msg="{{ correctMessage }}" data-incorrect-msg="{{ incorrectMessage }}">
  <p class="quiz__question">{{ question }}</p>
  <div class="quiz__options">
    {% for option in options %}
      <button class="quiz__option" type="button" data-correct="{{ option.isCorrect }}">
        <span class="quiz__option-text">{{ option.text }}</span>
        <i class="quiz__status-icon fa-solid" aria-hidden="true"></i>
        <span class="quiz__option-explanation" hidden>{{ option.explanation | safe }}</span>
      </button>
    {% endfor %}
  </div>
</div>
{% endmacro %}